---
title: "Designing Twitter"
date: 2022-02-17T23:23:21+08:00
draft: true
---

## 容易陷入的误区
在考虑一个系统设计的初期，要规避一些容易陷入的误区。比较典型的有下面几种
1. 用想象中的具体”答案“回答一个系统设计问题。比如要使用Redis去解决缓存，使用Nosql去解决数据结构扩展。等等
2. 期待一个大而全的系统设计。比如列出一个20个功能列表，什么都想要。
3. 太多的局部细节。A工具比B工具模型好在哪。
这也是一些初级和高级或者架构师考虑问题的差异。

表较好的设计方式是，快速找到一个最小可行产品的设计。通常来说，3到5个核心功能足以覆盖最小可行产品。如果你列出了一个比较长的设计列表，可能需要从中间选出核心价值，或者这个产品本身不够精准。

## 功能模型
我们回到Twitter的业务模型上。一个Twitter的典型模型有以下几个功能。
1. 发twitter
2. 关注
3. 查看Home Timeline

### 最小可行产品的设计(MVP)
确定了模型范围，我们开始做最小可行性的产品设计。(minimum viable product, MVP)，上述模型，是否是一个最小可行性的产品。

### 功能外要考虑达到的目标
在设计功能的场景，还需要考虑的一些目标
1. 读优化
2. 特定级别的用户的优化（超级明星）
3. 低延迟，创建个人时间线
作为高级研发人员的设计要求还有一些通用的
1. 高可用

## 让我们开始设计
### 功能API设计
面向资源的设计规范

Post: tweets/create
Get: tweets
Post: tweet/like
Post: tweet/reply

### 流程图
User从浏览器开始，提交API
会通过Loadbalance访问多个无状态节点的server，提供API响应，server返回用户或者tweets。这些数据保存在数据库中，是个多个备份的数据库，一般是2个备份的机制。是否异地备份可以后续扩展问题中讨论。

这个过程会涉及到用户访问session问题，也可以单独做扩展问题。比较典型解决方案。
   1. 使用hash，分布式哈希，计算用户访问的数据节点，保证一致。
   2. 使用缓存或者NosqlDB记录session，提供下次登录用户信息一致



## 28法则分配

## 扩展问题

### 热门
### 关注推荐
### 搜索