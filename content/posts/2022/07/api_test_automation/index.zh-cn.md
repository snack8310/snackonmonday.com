---
title: "选择自动化测试-一个降成本的选择"
date: 2022-07-20T17:25:51+08:00
draft: false
---

## 测试的本质

### 测试价值
现在软件开发领域中，基于狭隘的功能产品测试定义，测试一直是一个成本投入和系统质量的平衡产物。

### 常见的测试问题
基于成本投入的问题，常见的问题也可以预想到：
1. 测试资源不足。
2. 遗漏的测试点造成了故障。
3. 改动造成其他业务收到影响。
4. 高并发的场合无法充分测试。

另一个管理视角下：
1. 不好衡量测试资源的缺口
2. 测试并不容易体现个人价值，善战者无赫赫之功。
3. 测试作业强依赖人的主观能力。

### 测试问题的本质
细分上述问题，会看到主要的问题，出现在“测试人员”这个资源点。
这个资源点数量充分，则问题就会比较少；资源点能力好，则问题也会比较少。
回到测试价值的说明，测试是个成本投入和系统质量平衡的产物，注定不会有富裕的资源，有什么更好的办法解决。

## 选择自动化测试

### 自动化测试意义
为了尝试解决“测试人员”资源，大家逐渐尝试使用一些工具去执行，行业里也产生了大量的自动化的测试概念和工具。
比较典型的分类就是UI测试，接口测试，单元测试。

### 自动化测试的三个层级
- UI自动化：通过Web，移动端的操作录制等方式，验证系统用户操作的脚本
- 接口自动化：面向服务端的接口，进行数据验证
- 单元测试自动化：研发开发过程中，进行的开发单元的测试

越往上，测试难度越大，测试构建成本越大。

是不是越往下越好。也不是。
单元测试接口，更多的是开发资源，这部分需要跟业务产出价值PK，开发效率的降低和质量的提升比，并没有明显的优势。

### 怎么选择使用哪部分的自动化测试
还是基于成本和收益，平衡的看各自业务的情况进行选择。
如果是一个偏金融交易支付，数字高敏感的，建议采用单元测试+接口自动化
如果是一个偏用户体验的c端产品，优先UI自动化，防止因为一些zz的流程事故，造成的满意度下降。
如果是一个新项目，需要快速落地，拿到市场反馈，建议-不要使用自动化工具。

但是对于一般的项目来说，使用接口自动化测试，是可以长期降低测试资源成本的方案。

### 怎么做接口自动化测试
当然上述一个概念性的评估，我们来看一下，具体怎么构建一个自动化的测试。这个行业里比较成熟，引入一套接口测试自动化框架，还是很快的。

#### 系统构建
这类框架基本特点是，脚本化语言+数据统计+报告工具。
自动化测试框架有很多种，例如UI的 Selenium， Katalon，接口的 Allure，很多大厂也有自研的体系。
Allure是我们选择的方案。
整个核心模块是Python，Jenkins，Allue

### 基础环境配置
1. 物理机，虚拟机还是容器化均可。安装Python，Jenkis，Allure的对应版本。
2. 我们是个容器化的构建环境，主要的时间花费在于建立一个基本的版本镜像。以及安装Jenkins，Allue后的插件配置上。
3. 打通代码编译脚本和Jenkins的访问环境，编译实时拉取最新的测试脚本。
4. 建立自动化项目和测试环境及数据库的访问授权，如果是一个空间下，可选择忽略。
5. 在编译环境下增加一个“钩子”，用来将来触发自动化脚本实施，进行自动化的回归。这一个可选，非必须。

以上就是完整的自动化测试框架，
额外提示，由于整个测试链路是在测试环境中构建，并不需要高可用的配置，但要尽量把存储配置做到备份，毕竟工具插件，及测试用例执行器是不停的修改，一旦故障丢失，重新配置还是很疼的。

### 测试人员本地
1. Python
2. Allure

### 测试脚本的demo

```
@allure.feature('查询数据源数据')
class TestDatasource:

    # 前置条件
    @pytest.fixture(scope='class', autouse=True)
    def setup_class(cls, initialize):
        global host
        host = initialize.get('avengers-datasource')

    data_param,data_ids=read_yaml(__file__,'queryDatasource.yml')
    @allure.story('查询数据源数据')
    @pytest.mark.parametrize("args",data_param,ids=data_ids)
    def test_datasource(self,args):
        
        with allure.step('调用datasource-query接口'):
            response = DatasourceController(
                host).query_datasourceReport('6', (args['body']))
            LogHandler.info(response)
            assert response['code'] == 0,'查询数据失败'
            assert args['expected']==response['data'],'数据比对不上'
            
```

## 自动化测试的心得

### 与传统测试的区别

![流程节点的转变](./img/node-change.png#pic_center=300px)

比较明显的改变：
1. 取消了冒烟测试流程
2. 测试资源入场前置，与开发并行，需要与开发协同联调
3. 测试在通过了接口测试情况下，进行UI的验收
4. 测试的主要时间花费在数据构建上

### 自动化测试的优点
1. 从实战来说，要达到一个稳定的系统质量，成本是一个比较明显的优点。
   做一个粗略的评估，假设一个项目的人力测试成本为1的化，投入测试脚本的时间，保守的说可能是1.5。那么如果项目的第二次迭代，这是非常普遍的事情，测试脚本的修改平均用不上0.5。也就是第二次迭代起，自动化的收益就已经可以持平。
2. 系统回归场景有显著的时间优势。
3. 可以更快速的实施压力测试和性能测试。
4. 可以有效避免重复的故障二次发生。

### 自动化测试的缺点
1. 对于新项目的测试用例脚本编写时间显著拉长，意味着探索类项目，需要快速反馈的项目，不适用同时执行自动化。
2. 需要配合测试增加一些数据制作的接口，这是额外增加的成本。
3. 自动化并不能发现新问题。引入自动化后，降低的故障率是重复的错误部分，并不能防患于未然。
4. 对人员能力要求高。这部分是引入自动化测试后遇到的最明显的问题。

### 关于测试人员的变化
自动化测试，是把测试工作编程一些代码逻辑，虽然这个代码逻辑的脚本不需要像项目工程的高要求，但本身这个动作已经属于开发的一部分，对很多测试人员来说是不适应的。
可以尝试做以下的事情：
1. 测试作为验收人员，写测试用例，研发完成测试脚本。
2. 引入部分开发人员，构建基本的脚本，测试同学在基础上去改造，二次加工。修改要比新建容易很多。
3. 测试开发一体。把脚本做成开发作业的一部分。测试直接验收UI。部分测试角色转变为测试开发，以提供更好的数据构建环境，降低测试脚本开发成本。

越往下，对测试的角色要求越低，对测试的能力要求越高。可以根据不同的实际情况，做选择。
必要的情况下，引入新的外部资源。

### 接口自动化的改善关注指标
- 需求量和测试用例比例 --- 意味着新编写的用例越来越少，测试作业量的减少。
- 系统故障和测试用例数量  --- 系统稳定性的提升，重复事故的减少。
- 回归用例测试执行时长和频率  --- 回归时间越短，频率越高，系统越稳定。

### 如何评估收益
理想情况下，自动化测试的收益，会在测试用例密度到达某个临界点后，显著提高。从而达到更好的测试开发人员对比。产品上线的密度增加，系统故障率的降低。
回归到测试的本质，长期来看，关注下述的指标。
1. 测试开发比。
2. 测试事故率。

## 总结
自动化测试的价值，即使没做过的人也能想象得到。但什么时机选择自动化，选择什么类型的，以及是否使用单元测试，使用UI自动化等，都要回归测试的本质。看投入的成本，带来的是否是正向的收益。究其根本，测试是个用来规避风险，而不是创造价值的，很容易被大家轻视。

- 构建一套接口自动化测试框架并不复杂
- 引入之后会有一些人员和流程的适配成本
- 从实战来说，这是个长期来看有效降低成本的项目，也是比较容易快速试错的项目，值得花时间去尝试。
