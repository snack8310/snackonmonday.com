---
title: "Prometheus中increase计算的初始值问题"
date: 2022-04-24T15:23:55+08:00
draft: true
description: Prometheus计算增量的场合，遇到了初始值计算偏差的问题，无法得到准确的增量
---

<!--more-->

### 问题背景
在一些业务中，Prometheus常被用来做数据监控和报警。
我们是一个2B的saas系统，使用Prometheus做B端用户的分配场景的数据统计。但在测试中，我们发现统计数据不准的问题。问题如下：
真实的业务中，在单位时间内，用户收到50单数据，但是Prometheus计算出的结果为48单。查询Grafana上的数据，可以看到用户收到的50单的增量日志图，但接口计算返回值48，这是什么问题呢，难道是官方接口有问题。

### 技术相关数据
现在有4台业务应用服务器，我们采用的是间隔15秒节点数据采集一次。
在30分钟内会将60万数据分配给大概100多个用户，每秒分配400单。
每个人平均每秒分到4单。
现在要统计这个单位时间内每个人分到的数据量。

### 补充说明
当然上述数据使用关系型数据库查询也是可行的，成本并不高，但是考虑到分配量告警等后续很多操作，选用的Prometheus。这部分就暂且不在深入讨论。

### 技术方案
我们使用的 sum(increase)